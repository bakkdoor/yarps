role :yarps, "yarps@www.flasht.de"

git = "/usr/local/bin/git"

set(:lib_term) do
  Capistrano::CLI.ui.ask "Gimme a search term: "
end

namespace :libs do
  desc "Durchsuche libs ordner"
  task :search do
    run "ls -x1 /usr/lib | grep -i #{lib_term}"
  end
end
 
namespace :disc do
  desc "Zeige freien speicherplatz an"
  task :space do
    run "df -h /"
  end
end

namespace :app do
  desc "Restart app (fcgi process)"
  task :restart do
    run "httpdocs/restart.rb"
  end

  desc "Update and restart application from git-repos"
  task :update do
    run "cd httpdocs/rails-app; #{git} fetch origin; #{git} merge origin/master; ../restart.rb"
  end
end


namespace :tests do
  desc "Run unit-tests on application-server"
  task :units do
    run "cd httpdocs/rails-app/src; rake test:units"
  end
  
  desc "Run functional-tests on application-server"
  task :functionals do
    run "cd httpdocs/rails-app/src; rake test:functionals"
  end
end